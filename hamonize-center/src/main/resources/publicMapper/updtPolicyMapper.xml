<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
 
<mapper namespace="com.mapper.IUpdtPollicyMapper">



	<delete id="updtDeleteProgrm" parameterType="java.util.Map">
		DELETE FROM tbl_policy_progrm_block_list
		WHERE 
		<foreach collection="list" item="item" separator=" or ">
			( domain = #{item.domain} and pcm_name = #{item.debname} )
		</foreach>
	</delete>
	
	<delete id="deleteProccessBlockProgrm" parameterType="java.util.Map">
		DELETE FROM tbl_act_progrm_log
		WHERE 
		<foreach collection="list" item="item" separator=" or ">
			(pc_uuid = #{item.pc_uuid}
			and progrmname = #{item.debname})
		</foreach>
	</delete>

	<insert id="updtInsertProgrm" parameterType="com.model.UpdtPolicyVo">
		INSERT INTO tbl_policy_progrm_block_list (domain, pcm_name, pcm_seq, pcm_path, rgstr_date)
		SELECT #{domain}, #{debname}, (select pu_seq from tbl_policy_package_list where pu_name = #{debname}), #{path} , now()
		WHERE NOT EXISTS (SELECT * FROM tbl_policy_progrm_block_list WHERE pcm_name= #{debname} and domain=#{domain} )        
	</insert>
	
 	<insert id="updtPolicyActionResultInsert" parameterType="java.util.Map">   
		INSERT INTO 
			tbl_act_updt_log (
			   debname,
			   debver,
			   status, 
			   path, 
			   kind, 
			   pc_uuid, 
			   org_seq,
			   rgstr_date 
			)
			VALUES
			<foreach collection="list" item="item" separator=" , ">
	            (
	            	#{item.debname}, 
	            	#{item.debver}, 
	            	#{item.state}, 
	            	#{item.path}, 
	            	#{item.gubun}, 
	            	#{item.pc_uuid},
	             	(select org_seq from public.tbl_pc_mangr where pc_uuid = #{item.pc_uuid} ), 
	             	now()
	             )
	        </foreach>
			
	        
	</insert>
		
	
</mapper>
